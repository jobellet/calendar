<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Calendar | Beautiful, Smooth, Intuitive</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/utils.css">
    <link rel="stylesheet" href="css/header-img.css">
    <link rel="stylesheet" href="css/close-btn.css">
    <link rel="stylesheet" href="css/features.css">
    <link rel="stylesheet" href="css/calendar.css">

    <script src="https://unpkg.com/megajs@1/dist/main.browser-umd.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
</head>

<body>
    <div id="app-container">
        <!-- Mobile Menu Toggle (Floating) -->
        <button class="mobile-menu-toggle">‚ò∞</button>

        <!-- Settings Button -->
        <button id="settings-btn" title="Settings">‚öôÔ∏è</button>

        <!-- Sidebar Overlay -->
        <div id="sidebar-overlay"></div>

        <!-- Left Sidebar -->
        <aside id="left-sidebar">
            <button id="close-sidebar-btn" class="close-sidebar-btn">√ó</button>
            <div id="sync-section">
                <button id="sync-btn" class="status-offline" title="Sync with MEGA">üîÑ</button>
                <span style="font-weight: 600; font-size: 14px; margin-left: 8px;">Sync Status</span>
                <button id="logout-btn" class="logout-btn hidden" title="Logout">üö™</button>
            </div>

            <div id="view-selector">
                <button type="button" data-view="dayGridMonth">Month</button>
                <button type="button" data-view="timeGridWeek">Week</button>
                <button type="button" data-view="timeGridDay">Day</button>
                <button type="button" data-view="hoursView">Hours</button>
            </div>

            <!-- Hours View Controls (Hidden by default) -->
            <div id="hours-view-controls" style="display: none; margin-top: 10px; gap: 5px; justify-content: center; flex-wrap: wrap;">
                <div style="display: flex; gap: 5px;">
                    <button id="hours-up-btn" class="nav-btn" title="Shift Earlier">‚ñ≤</button>
                    <button id="hours-reset-btn" class="nav-btn" title="Reset to Now">‚óè</button>
                    <button id="hours-down-btn" class="nav-btn" title="Shift Later">‚ñº</button>
                </div>
                <div style="display: flex; gap: 5px;">
                     <button id="hours-zoom-out-btn" class="nav-btn" title="Zoom Out (Squeeze)">-</button>
                     <button id="hours-zoom-in-btn" class="nav-btn" title="Zoom In (Stretch)">+</button>
                </div>
            </div>

            <div id="calendars-section">
                <h3>Calendars</h3>
                <div id="calendars-list"></div>
                <button id="add-calendar-btn" type="button">+ Add calendar</button>
            </div>

            <div id="tasks-section">
                <div class="tasks-header">
                    <button id="add-task-btn" type="button" title="Add a new task" style="width: 100%">+ Add Task</button>
                </div>
            </div>

            <div id="image-management-tab">
                <button id="open-image-panel-btn" type="button">üé® Images</button>
            </div>
        </aside>

        <!-- Main Calendar Area -->
        <main id="main-content">
            <div class="calendar-header">
                <div class="calendar-nav">
                    <button id="prev-btn" class="nav-btn">‚Üê</button>
                    <button id="today-btn" class="nav-btn">Today</button>
                    <button id="next-btn" class="nav-btn">‚Üí</button>
                </div>
                <h2 id="calendar-title">Month Year</h2>
            </div>
            <div id="calendar"></div>
            <!-- Mobile Floating Action Button -->
            <button class="fab-add-event">+</button>
        </main>

        <!-- Right Sidebar: time picker area -->
        <aside id="right-sidebar">
            <div id="time-hover-container">
                <div id="time-hover-indicator">Move here to choose a time</div>
                <div id="time-hover-help">Move the mouse up/down, then click to create an event at that time.</div>
            </div>
        </aside>
    </div>

    <!-- Settings Panel -->
    <div id="settings-panel" class="overlay">
        <div id="settings-content" class="modal-box">
            <button id="close-settings-panel-btn" type="button" class="close-modal-x">√ó</button>
            <h2>Settings</h2>
            <form id="settings-form">
                <label>
                    Language
                    <select id="settings-language">
                        <option value="en-US">English</option>
                        <option value="fr-FR">Fran√ßais</option>
                        <option value="es-ES">Espa√±ol</option>
                        <option value="de-DE">Deutsch</option>
                        <option value="it-IT">Italiano</option>
                    </select>
                </label>

                <div style="border-top: 1px solid #eee; margin: 10px 0;"></div>

                <h3>Voice Notifications</h3>
                <label class="checkbox-label">
                    <input type="checkbox" id="settings-voice-enabled">
                    Enable voice notifications
                </label>

                <div id="voice-settings-group">
                    <label>
                        Notify before start (minutes)
                        <input type="number" id="settings-voice-lead-time" min="0" max="1440" value="10">
                        <div id="settings-voice-lead-time-error" class="field-error" aria-live="polite"></div>
                    </label>

                    <label class="checkbox-label">
                        <input type="checkbox" id="settings-voice-at-start">
                        Notify when event starts
                    </label>
                </div>

                <button type="submit">Save Settings</button>
            </form>
        </div>
    </div>

    <!-- Image Management Panel -->
    <div id="image-management-panel" class="overlay">
        <div id="image-management-content" class="modal-box">
            <button id="close-image-panel-btn" type="button">‚úï</button>
            <h2>Images</h2>

            <section id="calendar-images-section">
                <h3>Calendar images</h3>
                <label>
                    Calendar
                    <select id="img-calendar-select"></select>
                </label>
                <label>
                    Image file
                    <input type="file" id="img-calendar-file" accept="image/*">
                </label>

                <!-- Preview Container -->
                <div class="image-preview-container">
                    <img id="img-calendar-preview" src="" alt="Preview" style="display: none;">
                </div>

                <div class="crop-controls">
                    <label>
                        Horizontal focus
                        <input type="range" id="img-calendar-crop-x" min="0" max="100" value="50">
                    </label>
                    <label>
                        Vertical focus
                        <input type="range" id="img-calendar-crop-y" min="0" max="100" value="50">
                    </label>
                </div>
                <button type="button" id="img-calendar-save-btn">Save calendar image</button>
            </section>

            <section id="category-images-section">
                <h3>Category images</h3>
                <label>
                    Category name
                    <input type="text" id="img-category-name">
                </label>
                <label>
                    Scope
                    <select id="img-category-scope">
                        <option value="all">All calendars</option>
                    </select>
                </label>
                <label>
                    Image file
                    <input type="file" id="img-category-file" accept="image/*">
                </label>

                <!-- Preview Container -->
                <div class="image-preview-container">
                    <img id="img-category-preview" src="" alt="Preview" style="display: none;">
                </div>

                <div class="crop-controls">
                    <label>
                        Horizontal focus
                        <input type="range" id="img-category-crop-x" min="0" max="100" value="50">
                    </label>
                    <label>
                        Vertical focus
                        <input type="range" id="img-category-crop-y" min="0" max="100" value="50">
                    </label>
                </div>
                <button type="button" id="img-category-save-btn">Save category image</button>
            </section>
        </div>
    </div>

    <!-- Login Overlay -->
    <div id="login-overlay" class="overlay">
        <div id="login-box" class="modal-box">
            <h2>Login to MEGA</h2>
            <form id="login-form">
                <label>
                    Email
                    <input type="email" id="login-email" required>
                </label>
                <label>
                    Password
                    <input type="password" id="login-password" required>
                </label>
                <button type="submit">Login</button>
                <button type="button" id="login-cancel-btn">Cancel</button>
            </form>
        </div>
    </div>

    <!-- Event creation Overlay -->
    <div id="event-overlay" class="overlay">
        <div id="event-box" class="modal-box">
            <button id="close-event-modal-btn" type="button" class="close-modal-x">√ó</button>
            <h2 id="event-form-title">Create event</h2>
            <form id="event-form">
                <input type="hidden" id="event-id">

                <label>Calendars</label>
                <div id="event-calendar-list" class="checkbox-list"></div>

                <label>
                    Name / Category
                    <input type="text" id="event-name" required>
                    <div id="event-image-suggestion" class="event-image-suggestion">Suggestion available: Click to use
                    </div>
                </label>

                <label>
                    Type
                    <select id="event-type">
                        <option value="event">Event</option>
                        <option value="task">Task</option>
                    </select>
                </label>

                <div class="event-image-group">
                    <label>
                        Event Image (Optional)
                        <input type="file" id="event-image-file" accept="image/*">
                    </label>
                    <img id="event-image-preview" class="event-image-preview" src="" alt="Event Image Preview">
                </div>

                <div class="event-all-day-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="event-all-day">
                        All day
                    </label>
                </div>

                <div class="datetime-grid">
                    <label>
                        Start Date
                        <input type="date" id="event-date" required>
                    </label>
                    <label id="event-start-time-label">
                        Start Time
                        <input type="time" id="event-start-time" required>
                    </label>

                    <label id="event-end-date-label" style="display:none;">
                        End Date
                        <input type="date" id="event-end-date">
                    </label>
                    <label id="event-end-time-label">
                        End Time
                        <input type="time" id="event-end-time" required>
                    </label>
                    <label id="event-duration-label">
                        Duration (minutes)
                        <input type="number" id="event-duration" min="1" value="60">
                    </label>
                </div>

                <label>
                    Recurrence
                    <select id="event-recurrence">
                        <option value="none">None</option>
                        <option value="daily">Daily</option>
                        <option value="weekly">Weekly</option>
                        <option value="biweekly">Every 2 weeks</option>
                        <option value="custom">Custom schedule</option>
                    </select>
                </label>

                <div id="custom-recurrence-options" class="hidden">
                    <div class="weekday-grid">
                        <span>Repeat on</span>
                        <div class="weekday-options">
                            <label><input type="checkbox" name="event-recurrence-days" value="0">Sun</label>
                            <label><input type="checkbox" name="event-recurrence-days" value="1">Mon</label>
                            <label><input type="checkbox" name="event-recurrence-days" value="2">Tue</label>
                            <label><input type="checkbox" name="event-recurrence-days" value="3">Wed</label>
                            <label><input type="checkbox" name="event-recurrence-days" value="4">Thu</label>
                            <label><input type="checkbox" name="event-recurrence-days" value="5">Fri</label>
                            <label><input type="checkbox" name="event-recurrence-days" value="6">Sat</label>
                        </div>
                    </div>
                    <label>
                        Every
                        <input type="number" id="event-recurrence-interval" min="1" value="1"> week(s)
                    </label>
                    <label>
                        Until
                        <input type="date" id="event-recurrence-until">
                    </label>
                </div>

                <button type="submit" id="event-save-btn">Save</button>
                <button type="button" id="event-reset-btn">Cancel</button>
            </form>
        </div>
    </div>

    <!-- Add Calendar Modal -->
    <div id="add-calendar-modal" class="overlay">
        <div class="modal-box">
            <button id="close-add-calendar-modal-btn" type="button" class="close-modal-x">√ó</button>
            <h2>Add Calendar</h2>
            <form id="add-calendar-form">
                <label>
                    Calendar Name
                    <input type="text" id="new-calendar-name" required>
                </label>
                <button type="submit">Create</button>
            </form>
        </div>
    </div>

    <script src="js/db.js"></script>
    <script src="js/services/historyService.js"></script>
    <script src="js/services/settingsService.js"></script>
    <script src="js/services/eventService.js"></script>
    <script src="js/services/imageService.js"></script>
    <script src="js/services/calendarService.js"></script>
    <script src="js/calendar-view.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/mega.js"></script>
    <script src="js/app.js"></script>
</body>

</html>