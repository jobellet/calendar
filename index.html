<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Calendar | Beautiful, Smooth, Intuitive</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/header-img.css">
    <link rel="stylesheet" href="css/close-btn.css">
    <link rel="stylesheet" href="css/features.css">

    <!-- FullCalendar Scheduler (includes Core + Standard + Premium plugins) -->
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar-scheduler@6.1.15/index.global.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar-rrule@6.1.15/index.global.min.js"></script>
</head>

<body>
    <div id="app-container">
        <!-- Mobile Header (Visible only on <768px via CSS) -->
        <header class="mobile-header" style="display: none;"> <!-- Styles will toggle display -->
            <button class="mobile-menu-toggle">â˜°</button>
            <h1 style="font-size: 18px; margin: 0; font-weight: 600; color: var(--primary-color);">Family Calendar</h1>
            <div style="width: 24px;"></div> <!-- Spacer -->
        </header>

        <!-- Sidebar Overlay -->
        <div id="sidebar-overlay"></div>

        <!-- Left Sidebar -->
        <aside id="left-sidebar">
            <div id="sync-section">
                <button id="sync-btn" class="status-offline" title="Sync with MEGA">ðŸ”„</button>
                <span style="font-weight: 600; font-size: 14px; margin-left: 8px;">Sync Status</span>
            </div>

            <div id="view-selector">
                <button type="button" data-view="dayGridMonth">Month</button>
                <button type="button" data-view="timeGridWeek">Week</button>
                <button type="button" data-view="timeGridDay">Day</button>
                <button type="button" data-view="hoursView">Hours</button>
            </div>

            <div id="calendars-section">
                <h3>Calendars</h3>
                <div id="calendars-list"></div>
                <button id="add-calendar-btn" type="button">+ Add calendar</button>
            </div>

            <div id="image-management-tab">
                <button id="open-image-panel-btn" type="button">ðŸŽ¨ Images</button>
            </div>
        </aside>

        <!-- Main Calendar Area -->
        <main id="main-content">
            <div id="calendar"></div>
            <!-- Mobile Floating Action Button -->
            <button class="fab-add-event" style="display: none;">+</button>
        </main>

        <!-- Right Sidebar: time picker area -->
        <aside id="right-sidebar">
            <div id="time-hover-container">
                <div id="time-hover-indicator">Move here to choose a time</div>
                <div id="time-hover-help">Move the mouse up/down, then click to create an event at that time.</div>
            </div>
        </aside>
    </div>

    <!-- Image Management Panel -->
    <div id="image-management-panel" class="overlay">
        <div id="image-management-content" class="modal-box">
            <button id="close-image-panel-btn" type="button">âœ•</button>
            <h2>Images</h2>

            <section id="calendar-images-section">
                <h3>Calendar images</h3>
                <label>
                    Calendar
                    <select id="img-calendar-select"></select>
                </label>
                <label>
                    Image file
                    <input type="file" id="img-calendar-file" accept="image/*">
                </label>

                <!-- Preview Container -->
                <div class="image-preview-container">
                    <img id="img-calendar-preview" src="" alt="Preview" style="display: none;">
                </div>

                <div class="crop-controls">
                    <label>
                        Horizontal focus
                        <input type="range" id="img-calendar-crop-x" min="0" max="100" value="50">
                    </label>
                    <label>
                        Vertical focus
                        <input type="range" id="img-calendar-crop-y" min="0" max="100" value="50">
                    </label>
                </div>
                <button type="button" id="img-calendar-save-btn">Save calendar image</button>
            </section>

            <section id="category-images-section">
                <h3>Category images</h3>
                <label>
                    Category name
                    <input type="text" id="img-category-name">
                </label>
                <label>
                    Scope
                    <select id="img-category-scope">
                        <option value="all">All calendars</option>
                    </select>
                </label>
                <label>
                    Image file
                    <input type="file" id="img-category-file" accept="image/*">
                </label>

                <!-- Preview Container -->
                <div class="image-preview-container">
                    <img id="img-category-preview" src="" alt="Preview" style="display: none;">
                </div>

                <div class="crop-controls">
                    <label>
                        Horizontal focus
                        <input type="range" id="img-category-crop-x" min="0" max="100" value="50">
                    </label>
                    <label>
                        Vertical focus
                        <input type="range" id="img-category-crop-y" min="0" max="100" value="50">
                    </label>
                </div>
                <button type="button" id="img-category-save-btn">Save category image</button>
            </section>
        </div>
    </div>

    <!-- Login Overlay -->
    <div id="login-overlay" class="overlay">
        <div id="login-box" class="modal-box">
            <h2>Login to MEGA</h2>
            <form id="login-form">
                <label>
                    Email
                    <input type="email" id="login-email" required>
                </label>
                <label>
                    Password
                    <input type="password" id="login-password" required>
                </label>
                <button type="submit">Login</button>
                <button type="button" id="login-cancel-btn">Cancel</button>
            </form>
        </div>
    </div>

    <!-- Event creation Overlay -->
    <div id="event-overlay" class="overlay">
        <div id="event-box" class="modal-box">
            <button id="close-event-modal-btn" type="button" class="close-modal-x">Ã—</button>
            <h2 id="event-form-title">Create event</h2>
            <form id="event-form">
                <input type="hidden" id="event-id">

                <label>
                    Calendar
                    <select id="event-calendar"></select>
                </label>

                <label>
                    Name / Category
                    <input type="text" id="event-name" required>
                    <div id="event-image-suggestion" class="event-image-suggestion">Suggestion available: Click to use
                    </div>
                </label>

                <div class="event-image-group">
                    <label>
                        Event Image (Optional)
                        <input type="file" id="event-image-file" accept="image/*">
                    </label>
                    <img id="event-image-preview" class="event-image-preview" src="" alt="Event Image Preview">
                </div>

                <label>
                    Date
                    <input type="date" id="event-date" required>
                </label>

                <label>
                    Start time
                    <input type="time" id="event-start-time" required>
                </label>

                <label>
                    End time
                    <input type="time" id="event-end-time" required>
                </label>

                <label>
                    Recurrence
                    <select id="event-recurrence">
                        <option value="none">None</option>
                        <option value="daily">Daily</option>
                        <option value="weekly">Weekly</option>
                        <option value="biweekly">Every 2 weeks</option>
                        <option value="custom">Custom schedule</option>
                    </select>
                </label>

                <div id="custom-recurrence-options" class="hidden">
                    <div class="weekday-grid">
                        <span>Repeat on</span>
                        <div class="weekday-options">
                            <label><input type="checkbox" name="event-recurrence-days" value="0">Sun</label>
                            <label><input type="checkbox" name="event-recurrence-days" value="1">Mon</label>
                            <label><input type="checkbox" name="event-recurrence-days" value="2">Tue</label>
                            <label><input type="checkbox" name="event-recurrence-days" value="3">Wed</label>
                            <label><input type="checkbox" name="event-recurrence-days" value="4">Thu</label>
                            <label><input type="checkbox" name="event-recurrence-days" value="5">Fri</label>
                            <label><input type="checkbox" name="event-recurrence-days" value="6">Sat</label>
                        </div>
                    </div>
                    <label>
                        Every
                        <input type="number" id="event-recurrence-interval" min="1" value="1"> week(s)
                    </label>
                    <label>
                        Until
                        <input type="date" id="event-recurrence-until">
                    </label>
                </div>

                <button type="submit" id="event-save-btn">Save</button>
                <button type="button" id="event-reset-btn">Cancel</button>
            </form>
        </div>
    </div>

    <script src="js/db.js"></script>
    <script src="js/services/historyService.js"></script>
    <script src="js/services/eventService.js"></script>
    <script src="js/services/imageService.js"></script>
    <script src="js/services/calendarService.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/mega.js"></script>
    <script src="js/app.js"></script>
</body>

</html>